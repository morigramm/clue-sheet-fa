<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>برگه تحقیقات بازی سرنخ کلودو</title>
  <style>
    :root{
      --bg:#f7f8fb; --card:#fff; --text:#111827; --muted:#6b7280;
      --ok:#16a34a; --ques:#000000; --bad:#ef4444; --accent:#2b6cb0;
      --input-bg:#ffffff; --input-border:#d1d5db;
    }
    body{ margin:0; font-family: "Tahoma","Vazirmatn",system-ui,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--text); direction:rtl; padding:18px; -webkit-font-smoothing:antialiased; }
    body.dark{ --bg:#0b1220; --card:#06101a; --text:#e6eef8; --muted:#9aa6b2; --input-bg:#071021; --input-border:#123142; }
    header{ display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom:14px; }
    header h1{ margin:0; font-size:18px; }
    .controls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .btn{ background:var(--card); border:1px solid rgba(0,0,0,0.06); padding:8px 10px; border-radius:8px; cursor:pointer; font-size:14px; color:var(--text); }
    .btn.primary{ background:var(--accent); color:white; border-color:transparent; }
    .mode-toggle .btn.active{ box-shadow:0 0 0 3px rgba(43,108,176,0.12); border-color:var(--accent); }
    main{ display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:12px; }
    .card{ background:var(--card); border-radius:10px; padding:12px; box-shadow:0 1px 3px rgba(15,23,42,0.04); min-height:140px; }
    .card h2{ margin:0 0 8px 0; font-size:20px; }
    ul.item-list{ list-style:none; margin:0; padding:0; display:grid; gap:-4px; }
    li.item{ display:flex; align-items:center; gap:10px; padding:2px; border-radius:8px; border:1px solid transparent; background:transparent; }
    li.item:hover{ background: rgba(0,0,0,0.03); }
    .label{ flex:1; text-align:right; padding-right:6px; }
    .marker{ width:36px; height:30px; border-radius:8px; display:inline-grid; place-items:center; font-weight:700; cursor:pointer; min-width:36px; }
    .marker.none{ background:transparent; color:var(--muted); border:1px dashed rgba(0,0,0,0.06); }
    .marker.ok{ background:rgba(22,163,74,0.12); color:var(--ok); border:1px solid rgba(22,163,74,0.16); }
    .marker.ques{ background:rgba(0,0,0,0.06); color:var(--ques); border:1px solid rgba(0,0,0,0.12); }
    .marker.bad{ background:rgba(239,68,68,0.08); color:var(--bad); border:1px solid rgba(239,68,68,0.12); }
    input.note{ width:160px; padding:6px 8px; border-radius:6px; border:1px solid var(--input-border); background:var(--input-bg); color:var(--text); font-size:13px; }
    .small{ font-size:13px; color:var(--muted); }
    footer{ margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    @media (pointer:coarse){ .btn{padding:12px 14px} li.item{padding:12px} input.note{width:120px} }
  </style>
</head>
<body>
  <header>
    <h1>برگه تحقیقات بازی سرنخ کلودو</h1>
    <div class="controls">
      <div class="mode-toggle" title="حالت علامت‌گذاری">
        <button class="btn" data-mode="cycle" id="mode-cycle">حالت: چرخه</button>
      </div>
      <button class="btn" id="clear-all">پاک کردن همه</button>
      <button class="btn" id="toggle-theme">حالت تاریک</button>
    </div>
  </header>

  <main>
    <section class="card" aria-labelledby="suspects-title">
      <h2 id="suspects-title">مظنون‌ها</h2>
      <ul class="item-list" id="suspects">
  <li class="item" data-id="sus-1">
    <div class="label">سرهنگ ماسترد</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="sus-2">
    <div class="label">دکتر ارکید</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="sus-3">
    <div class="label">پروفسور پلام</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="sus-4">
    <div class="label">پدر گرین</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="sus-5">
    <div class="label">خانم پیکاک</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="sus-6">
    <div class="label">دوشیزه اسکارلت</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
</ul>
    </section>

    <section class="card" aria-labelledby="weapons-title">
      <h2 id="weapons-title">آلات قتل</h2>
   <ul class="item-list" id="weapons">
  <li class="item" data-id="weap-1">
    <div class="label">خنجر</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="weap-2">
    <div class="label">شمعدان</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="weap-3">
    <div class="label">تپانچه</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="weap-4">
    <div class="label">طناب</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="weap-5">
    <div class="label">لوله</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="weap-6">
    <div class="label">آچار</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
</ul>
    </section>

    <section class="card" aria-labelledby="rooms-title">
      <h2 id="rooms-title">اتاق‌ها</h2>
     <ul class="item-list" id="rooms">
  <li class="item" data-id="room-1">
    <div class="label">غذاخوری</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="room-2">
    <div class="label">آشپزخانه</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="room-3">
    <div class="label">حمام</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="room-4">
    <div class="label">احیاط</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="room-5">
    <div class="label">گاراژ</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="room-6">
    <div class="label">اتاق بازی</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="room-7">
    <div class="label">اتاق خواب</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="room-8">
    <div class="label">اتاق نشیمن</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
  <li class="item" data-id="room-9">
    <div class="label">اتاق مطالعه</div>
    <input class="note" placeholder="توضیح کوتاه...">
    <div class="marker none">–</div>
  </li>
</ul>
    </section>
  </main>


<script>
(function(){
  const cycle = ['bad','ques','ok','none'];
  let currentMode = 'cycle';
  const storageKey = 'clue-fa-state-v1';
  const body = document.documentElement;

  // mode buttons
  document.querySelectorAll('.mode-toggle .btn').forEach(b=>{
    b.addEventListener('click', ()=>{
      document.querySelectorAll('.mode-toggle .btn').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      currentMode = b.dataset.mode;
    });
  });
  document.getElementById('mode-cycle').classList.add('active');

  function applyMarker(el, state){
    el.classList.remove('none','ok','ques','bad');
    el.classList.add(state);
    el.textContent = state==='none'?'–': state==='ok'?'✓': state==='ques'?'?':'✖';
  }

  // initialize items
  const items = document.querySelectorAll('li.item');
  items.forEach(li=>{
    const marker = li.querySelector('.marker');
    const note = li.querySelector('.note');
    marker.addEventListener('click', ()=>{
      let state = 'none';
      ['none','ok','ques','bad'].forEach(s=>{ if(marker.classList.contains(s)) state = s; });
      if(currentMode === 'cycle'){
        const idx = cycle.indexOf(state);
        const next = cycle[(idx+1)%cycle.length];
        applyMarker(marker, next);
      } else {
        if(state === currentMode) applyMarker(marker, 'none');
        else applyMarker(marker, currentMode);
      }
      saveStateDebounced();
    });
    // update save on note edit
    note.addEventListener('input', saveStateDebounced);
  });

  // clear all
  document.getElementById('clear-all').addEventListener('click', ()=>{
    if(!confirm('آیا مطمئن هستید همهٔ علامت‌ها و یادداشت‌ها پاک شوند؟')) return;
    items.forEach(li=>{
      applyMarker(li.querySelector('.marker'),'none');
      li.querySelector('.note').value = '';
    });
    saveState();
  });

  // export JSON to clipboard
  document.getElementById('export-json').addEventListener('click', async ()=>{
    const data = collectState();
    const json = JSON.stringify(data, null, 2);
    try { await navigator.clipboard.writeText(json); alert('JSON در کلیپ‌بورد کپی شد.'); }
    catch(e){ prompt('JSON را کپی کنید:', json); }
  });

  // theme toggle
  const themeBtn = document.getElementById('toggle-theme');
  function setTheme(dark){
    if(dark) document.body.classList.add('dark');
    else document.body.classList.remove('dark');
    localStorage.setItem('clue-fa-dark', dark ? '1' : '0');
    themeBtn.textContent = dark ? 'حالت روشن' : 'حالت تاریک';
  }
  themeBtn.addEventListener('click', ()=> setTheme(!document.body.classList.contains('dark')));
  // init theme from storage or prefers-color-scheme
  const savedDark = localStorage.getItem('clue-fa-dark');
  if(savedDark===null){
    const prefers = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    setTheme(prefers);
  } else setTheme(savedDark==='1');

  // collect state
  function collectState(){
    const out = { items: {} , meta: { savedAt: new Date().toISOString() } };
    document.querySelectorAll('li.item').forEach(li=>{
      const id = li.dataset.id;
      const label = li.querySelector('.label').innerText.trim();
      const marker = li.querySelector('.marker');
      const state = ['none','ok','ques','bad'].find(s=>marker.classList.contains(s)) || 'none';
      const note = li.querySelector('.note').value || '';
      out.items[id] = { label, state, note };
    });
    return out;
  }

  // save / load
  function saveState(){
    try{ localStorage.setItem(storageKey, JSON.stringify(collectState())); }catch{}
  }
  let saveTimer = null;
  function saveStateDebounced(){
    if(saveTimer) clearTimeout(saveTimer);
    saveTimer = setTimeout(()=>{ saveState(); saveTimer = null; }, 300);
  }

  function loadState(){
    try{
      const raw = localStorage.getItem(storageKey);
      if(!raw) return;
      const obj = JSON.parse(raw);
      if(!obj.items) return;
      Object.keys(obj.items).forEach(id=>{
        const el = document.querySelector(`li.item[data-id="${id}"]`);
        if(!el) return;
        const marker = el.querySelector('.marker');
        const note = el.querySelector('.note');
        const s = obj.items[id].state || 'none';
        applyMarker(marker, s);
        note.value = obj.items[id].note || '';
      });
    }catch(e){}
  }

  // import via Ctrl+Shift+V
  window.addEventListener('keydown', (e)=>{
    if(e.ctrlKey && e.shiftKey && e.key.toLowerCase()==='v'){
      const raw = prompt('لطفاً JSON وضعیت را جای‌گذاری کنید:');
      if(!raw) return;
      try{
        const obj = JSON.parse(raw);
        if(!obj.items) throw new Error('invalid');
        Object.keys(obj.items).forEach(id=>{
          const el = document.querySelector(`li.item[data-id="${id}"]`);
          if(!el) return;
          applyMarker(el.querySelector('.marker'), obj.items[id].state || 'none');
          el.querySelector('.note').value = obj.items[id].note || '';
        });
        saveState();
        alert('وضعیت بارگذاری و ذخیره شد.');
      }catch(err){ alert('JSON معتبر نیست.'); }
    }
  });

  // init: set default markers to none
  document.querySelectorAll('.marker').forEach(m=>{
    if(!m.classList.contains('none') && !m.classList.contains('ok') && !m.classList.contains('ques') && !m.classList.contains('bad')){
      m.classList.add('none'); m.textContent = '–';
    }
  });

  loadState();
})();
</script>
</body>
</html>
